<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
</head>
<body>
    <div class="status-container">
        <div class="cart-header">
            <a href="{{ url_for('client.index') }}" class="back-button">‚Üê</a>
            <div class="cart-title">–ó–∞–∫–∞–∑{% if order %} ‚Ññ{{ order.id }}{% endif %}</div>
            <div></div>
        </div>
        {% if order %}
            <!-- Progress bar -->
            {% set statuses = ['–ø—Ä–∏–Ω—è—Ç', '–≥–æ—Ç–æ–≤–∏—Ç—Å—è', '–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è'] %}
            {% if order.status == '–ø—Ä–∏–Ω—è—Ç' %}
                {% set step = 0 %}
            {% elif order.status == '–≥–æ—Ç–æ–≤–∏—Ç—Å—è' %}
                {% set step = 1 %}
            {% elif order.status == '–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è' %}
                {% set step = 2 %}
            {% else %}
                {% set step = -1 %}
            {% endif %}
            <div class="progress-bar">
                <div class="progress-line"></div>
                {# –î–µ–ª–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏: –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Å–µ–≥–º–µ–Ω—Ç –≤ —Å—Å—ã–ª–∫—É #}
                {% for s in statuses %}
                    <a href="#" class="progress-segment {% if loop.index0 <= step %}active{% endif %}" style="text-decoration:none; color:inherit;">
                        <div class="dot"></div>
                        <span>{{ s.capitalize() }}</span>
                    </a>
                {% endfor %}
            </div>

            <!-- Order details -->
            <div class="order-details">
                <p><strong>–°—Ç–æ–ª:</strong> {{ order.table_id }}</p>
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ order.status }}</p>
                {% if order.comment %}
                    <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ order.comment }}</p>
                {% endif %}
                <p><strong>–ë–ª—é–¥–∞:</strong></p>
                <ul style="margin-left: 16px; padding-left: 0; list-style-position: inside;">
                    {% for item in order.items %}
                        <li>{{ item.dish.name }} √ó{{ item.quantity }}</li>
                    {% endfor %}
                </ul>
            </div>

            <button class="refresh-btn" id="refreshBtn">–û–±–Ω–æ–≤–∏—Ç—å (<span id="refreshTimer">5</span> —Å–µ–∫)</button>
        {% else %}
            <p style="padding: 16px; font-size: 16px;">–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω</p>
        {% endif %}
    </div>

    <!-- Optional navigation bar for order page (–∫–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã —É–±—Ä–∞–Ω–∞) -->
    <div class="navbar">
        <a href="{{ url_for('client.index') }}" class="nav-item">
            <div class="icon">üè†</div>
            <div>–ú–µ–Ω—é</div>
        </a>
        <a href="#" class="nav-item active">
            <div class="icon">‚úîÔ∏è</div>
            <div>–°—Ç–∞—Ç—É—Å</div>
        </a>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var timerSpan = document.getElementById('refreshTimer');
        var seconds = parseInt(timerSpan ? timerSpan.textContent : '0');
        // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à—ë–Ω, —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –º–µ–Ω—é
        {% if order and order.status == '–∑–∞–≤–µ—Ä—à—ë–Ω' %}
            window.location.href = "{{ url_for('client.index') }}";
            return;
        {% endif %}
        // –¢–∞–π–º–µ—Ä –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        var interval = setInterval(function() {
            if (typeof seconds !== 'number' || isNaN(seconds)) {
                clearInterval(interval);
                return;
            }
            seconds--;
            if (seconds <= 0) {
                clearInterval(interval);
                location.reload();
            }
            if (timerSpan) {
                timerSpan.textContent = seconds;
            }
        }, 1000);
        var btn = document.getElementById('refreshBtn');
        if (btn) {
            btn.addEventListener('click', function() {
                location.reload();
            });
        }
    });
    </script>
</body>
</html>