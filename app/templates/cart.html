<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корзина</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
</head>
<body>
{# Вычисляем только количество позиций в корзине. Итоговая сумма не отображается. #}
{% set total_items = 0 %}
{% for dish in dishes %}
    {% set qty = cart[dish.id|string] %}
    {% set total_items = total_items + qty %}
{% endfor %}
    <div class="cart-header">
        <a href="{{ url_for('client.index') }}" class="back-button">←</a>
        <div class="cart-title">Корзина</div>
        <div class="cart-summary">
            <span>{{ total_items }}</span>
        </div>
    </div>

    <form action="{{ url_for('client.submit_order') }}" method="POST">
        <div class="cart-items">
            {% for dish in dishes %}
            <div class="cart-item">
                <div class="cart-item-info">
                    {% if dish.image_filename %}
                        {% if dish.image_filename.startswith('http') %}
                            <img src="{{ dish.image_filename }}" alt="{{ dish.name }}">
                        {% else %}
                            <img src="{{ url_for('static', filename='img/' + dish.image_filename) }}" alt="{{ dish.name }}">
                        {% endif %}
                    {% else %}
                        <!-- Use a generic logo as fallback -->
                        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="{{ dish.name }}">
                    {% endif %}
                    <div class="cart-item-details">
                        <span class="cart-item-name">{{ dish.name }}</span>
                        <span class="cart-item-price">{{ '%.0f'|format(dish.price) }} ₽</span>
                    </div>
                </div>
                <div class="qty-control">
                    <button type="button" class="qty-btn qty-minus">−</button>
                    <input type="number" name="quantities[{{ dish.id }}]" value="{{ cart[dish.id|string] }}" min="1" class="qty-input">
                    <button type="button" class="qty-btn qty-plus">+</button>
                </div>
            </div>
            {% endfor %}
        </div>
        {# Блок с общей суммой заказа удалён по требованиям #}
        <div class="order-comment">
            <input type="number" name="table_id" placeholder="Номер стола" required>
        </div>
        <div class="order-comment">
            <input type="text" name="comment" placeholder="Комментарий к заказу">
        </div>
        <button type="submit" class="btn-order">Оформить заказ</button>
    </form>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.cart-item').forEach(function(item) {
            var minus = item.querySelector('.qty-minus');
            var plus = item.querySelector('.qty-plus');
            var input = item.querySelector('input.qty-input');
            minus.addEventListener('click', function() {
                var val = parseInt(input.value) || 1;
                if (val > 1) {
                    input.value = val - 1;
                }
            });
            plus.addEventListener('click', function() {
                var val = parseInt(input.value) || 1;
                input.value = val + 1;
            });
        });
    });
    </script>
</body>
</html>